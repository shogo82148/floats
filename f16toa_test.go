package floats

import (
	"math"
	"testing"
)

func TestFloat16_Text(t *testing.T) {
	tests := []struct {
		x    Float16
		fmt  byte
		prec int
		s    string
	}{
		/****** decimal formats ******/
		{0, 'f', -1, "0"},
		{0x8000, 'f', -1, "-0"},
		{exact16(math.Inf(1)), 'f', -1, "+Inf"},
		{exact16(math.Inf(-1)), 'f', -1, "-Inf"},
		{exact16(math.NaN()), 'f', -1, "NaN"},

		{exact16(0x1p-24), 'f', 24, "0.000000059604644775390625"},
		{exact16(0x2p-24), 'f', 24, "0.000000119209289550781250"},
		{exact16(0x3p-24), 'f', 24, "0.000000178813934326171875"},
		{exact16(0x4p-24), 'f', 24, "0.000000238418579101562500"},
		{exact16(0x5p-24), 'f', 24, "0.000000298023223876953125"},
		{exact16(0x6p-24), 'f', 24, "0.000000357627868652343750"},
		{exact16(0x7p-24), 'f', 24, "0.000000417232513427734375"},
		{exact16(0x8p-24), 'f', 24, "0.000000476837158203125000"},
		{exact16(0x9p-24), 'f', 24, "0.000000536441802978515625"},
		{exact16(0xap-24), 'f', 24, "0.000000596046447753906250"},

		{exact16(0x1p-24), 'f', 23, "0.00000005960464477539062"},
		{exact16(0x2p-24), 'f', 23, "0.00000011920928955078125"},
		{exact16(0x3p-24), 'f', 23, "0.00000017881393432617188"},
		{exact16(0x4p-24), 'f', 23, "0.00000023841857910156250"},
		{exact16(0x5p-24), 'f', 23, "0.00000029802322387695312"},
		{exact16(0x6p-24), 'f', 23, "0.00000035762786865234375"},
		{exact16(0x7p-24), 'f', 23, "0.00000041723251342773438"},
		{exact16(0x8p-24), 'f', 23, "0.00000047683715820312500"},
		{exact16(0x9p-24), 'f', 23, "0.00000053644180297851562"},
		{exact16(0xap-24), 'f', 23, "0.00000059604644775390625"},

		{exact16(0x1p-24), 'f', -1, "0.0000000596"},
		{exact16(0x2p-24), 'f', -1, "0.0000001192"},
		{exact16(0x3p-24), 'f', -1, "0.0000001788"},
		{exact16(0x4p-24), 'f', -1, "0.0000002384"},
		{exact16(0x5p-24), 'f', -1, "0.000000298"},
		{exact16(0x6p-24), 'f', -1, "0.0000003576"},
		{exact16(0x7p-24), 'f', -1, "0.0000004172"},
		{exact16(0x8p-24), 'f', -1, "0.000000477"},
		{exact16(0x9p-24), 'f', -1, "0.0000005364"},
		{exact16(0xap-24), 'f', -1, "0.000000596"},

		{exact16(10), 'f', -1, "10"},
		{exact16(100), 'f', -1, "100"},
		{exact16(1000), 'f', -1, "1000"},
		{exact16(10000), 'f', -1, "10000"},
		{exact16(65504), 'f', -1, "65500"},
		{exact16(-1), 'f', -1, "-1"},
		{exact16(-10), 'f', -1, "-10"},
		{exact16(-100), 'f', -1, "-100"},
		{exact16(-1000), 'f', -1, "-1000"},
		{exact16(-10000), 'f', -1, "-10000"},
		{exact16(-65504), 'f', -1, "-65500"},

		// random numbers
		{0x816f, 'f', -1, "-0.00002187"},
		{0xadaa, 'f', -1, "-0.0885"},
		{0x92dc, 'f', -1, "-0.0008373"},
		{0xf4ca, 'f', -1, "-19620"},
		{0x7aa7, 'f', -1, "54500"},
		{0x3734, 'f', -1, "0.4502"},
		{0x2ac3, 'f', -1, "0.05283"},
		{0xe6d6, 'f', -1, "-1750"},
		{0x700f, 'f', -1, "8310"},
		{0x2000, 'f', -1, "0.007812"},
		{0x2400, 'f', -1, "0.01563"},
		{0xa000, 'f', -1, "-0.007812"},
		{0xa400, 'f', -1, "-0.01563"},

		/****** binary exponent formats ******/
		{0, 'b', -1, "0p-24"},
		{0x8000, 'b', -1, "-0p-24"},
		{exact16(math.Inf(1)), 'x', -1, "+Inf"},
		{exact16(math.Inf(-1)), 'x', -1, "-Inf"},
		{exact16(math.NaN()), 'x', -1, "NaN"},

		{0x0001, 'b', -1, "1p-24"},
		{exact16(1), 'b', -1, "1024p-10"},
		{exact16(1.5), 'b', -1, "1536p-10"},
		{exact16(65504), 'b', -1, "2047p+5"},

		/******* hexadecimal formats *******/
		{0, 'x', -1, "0x0p+00"},
		{0x8000, 'x', -1, "-0x0p+00"},
		{exact16(math.Inf(1)), 'x', -1, "+Inf"},
		{exact16(math.Inf(-1)), 'x', -1, "-Inf"},
		{exact16(math.NaN()), 'x', -1, "NaN"},

		{exact16(0x0.0p0), 'x', 0, "0x0p+00"},
		{exact16(0x1.0p0), 'x', 0, "0x1p+00"},
		{exact16(0x1.7p0), 'x', 0, "0x1p+00"},
		{exact16(0x1.8p0), 'x', 0, "0x1p+01"},

		{exact16(0x0.0p0), 'x', 1, "0x0.0p+00"},
		{exact16(0x1.0p0), 'x', 1, "0x1.0p+00"},
		{exact16(0x1.fp0), 'x', 1, "0x1.fp+00"},
		{exact16(0x1.ffc0p0), 'x', 1, "0x1.0p+01"},
		{exact16(0x1.08p0), 'x', 1, "0x1.0p+00"},
		{exact16(0x1.18p0), 'x', 1, "0x1.2p+00"},

		{exact16(0x0.00p0), 'x', 2, "0x0.00p+00"},
		{exact16(0x1.00p0), 'x', 2, "0x1.00p+00"},
		{exact16(0x1.0fp0), 'x', 2, "0x1.0fp+00"},
		{exact16(0x1.ffc0p0), 'x', 2, "0x1.00p+01"},
		{exact16(0x1.008p0), 'x', 2, "0x1.00p+00"},
		{exact16(0x1.018p0), 'x', 2, "0x1.02p+00"},

		{exact16(0x0.000p0), 'x', 3, "0x0.000p+00"},
		{exact16(0x1.000p0), 'x', 3, "0x1.000p+00"},
		{exact16(0x1.00c0p0), 'x', 3, "0x1.00cp+00"},
		{exact16(0x1.ffc0p0), 'x', 3, "0x1.ffcp+00"},

		{exact16(0x1.ffc0p0), 'x', 4, "0x1.ffc0p+00"},
		{exact16(0x1p-24), 'x', 4, "0x1.0000p-24"},

		{exact16(0x1p0), 'x', -1, "0x1p+00"},
		{exact16(0x1.8p0), 'x', -1, "0x1.8p+00"},
		{exact16(0x1.08p0), 'x', -1, "0x1.08p+00"},
		{exact16(0x1.00cp0), 'x', -1, "0x1.00cp+00"},

		{0, 'X', -1, "0X0P+00"},
		{exact16(0x1.ffc0p0), 'X', 3, "0X1.FFCP+00"},
	}

	for _, tt := range tests {
		got := tt.x.Text(tt.fmt, tt.prec)
		if got != tt.s {
			t.Errorf("%#v: expected %s, got %s", tt, tt.s, got)
		}
	}
}
